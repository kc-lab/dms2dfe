.. _io:

==========================================
I/O
==========================================

Details about inputs and outputs of :ref:`dms2dfe`.

Inputs (configuration)
----------------------

Inputs of dms2dfe are located in `prj_dh/cfg/`.
They are .csv files. Namely

.. code-block:: text

    prj_dh (project directory)
    |-- cfg
    |   |-- info        : variables for a particular analysis eg. number of cores, host organism etc. 
    |   |-- lbls        : names of samples and corresponding paths to files.
    |   |-- fit         : pairs of input (before selection) and selected (after selection) samples.
    |   |-- comparison  : pairs of control (eg. untreated) and test (eg. treated) samples to be compared.
    |   |-- repli       : replicates to be averaged
    |   |-- feats       : custom features.
    |   `-- barcodes    : information about deplexing barcoded .fastq files.

Format of `info` configuration file
-----------------------------------

This includes the variables for a particular analysis.

.. code-block:: text

    prj_dh (project directory)
    |-- cfg
    |   |-- info
    |   |   |-- column varname          : names of input variables
    |   |   |-- column input            : inputs values
    |   |   |-- column default          : default values
    |   |   |-- column description      : details of values
    |   |   |   |-- Path to reference fasta file
    |   |   |   |-- Path to pdb file
    |   |   |   |-- Host name for assigning codon table
    |   |   |   |-- Number of cores to be used
    |   |   |   |-- Alignment type [loc:local| glob:global]
    |   |   |   |-- Cut off for frequency per mutant
    |   |   |   |-- Type of normalization across samples 
    |   |   |   |   [wild: wrt wild type | syn : wrt synonymous mutations | none : fold change serves as fitness]
    |   |   |   |-- Optional: residue numbers of active sites (space delimited) eg. 68<SPACE>192
    |   |   |   |-- Optional: path to dssp module
    |   |   |   |-- Optional: path to trimmomatic source (.jar) file
    |   |   |   |-- Optional: path to bowtie2 source file
    |   |   |   |-- Optional: path to samtools source file
    |   |   |   `-- Optional: if reference sequence is concatamer


`info` can be edited in multiple ways as describes in :ref:`usage`.

Formats of other configuration files
------------------------------------

In addition, other csv files in `prj_dh/cfg/` need to be filled. 

.. code-block:: text

    prj_dh (project directory)
    |-- cfg
    |   |-- lbls                        : names of samples and corresponding paths to files. 
    |   |   |-- column  varname         : sample names, 
    |   |   |-- column  fhs_1           : paths to input files (.fastq or .sam or .bam or .mut_cds) 
    |   |   `-- column  fhs_2           : paths to reverse (R2) of pair ended .fastq files. 
    |   |-- fit                         : pairs of input (before selection) and selected (after selection) samples.
    |   |   |-- column  unsel           : names of input (unselected) samples, 
    |   |   `-- columns sel_1,sel_2,..  : names of selected samples
    |   |-- comparison                  : pairs of control (eg. untreated) and test (eg. treated) samples to be compared.
    |   |   |-- column  ctrl            : names of control samples, 
    |   |   `-- columns test_1,test_2,..: names of test samples  
    |   |-- repli                       : replicates to be averaged.
    |   |   |-- column  varname         : names of averages samples
    |   |   `-- columns replicate_1,replicate_2,.. : names of replicates
    |   |-- feats                       : custom features.
    |   |   |-- column  aasi            : amino acid number, 
    |   |   `-- columns feat_1,feat_2,..: features (eg. conservation score).
    |   |-- barcodes                    : information about deplexing barcoded .fastq files.
    |   |   |-- column  fastq_R1_fh     : paths to forward (R1) fastq files, 
    |   |   |-- column  fastq_R2_fh     : paths to reverse (R2) fastq files,
    |   |   |-- column  barcode_R1      : sequence of forward (R1) barcode,
    |   |   |-- column  barcode_R2      : sequence of reverse (R2) barcode,
    |   |   `-- column  fastq_fn        : file names of output files.
    
For templates please have a look at test datasets located in `dms2dfe/test_dataset/`.

Outputs
-------

With a successful run of `dms2dfe` following output files are created.
Below is structure of output files generated.

.. code-block:: text

    prj_dh (project directory)
    |-- data_lbl	: frequencies of mutants
    |   |-- aas		: amino acid level
    |   `-- cds		: codon level
    |-- data_fit	: fitness of mutants
    |   |-- aas		: amino acid level
    |   `-- cds		: codon level
    |-- data_comparison	: comparison of fitness of mutants between test (eg. treated) and control (eg. untreated).
    |   |-- aas		: amino acid level
    |   `-- cds		: codon level
    |-- plots
    |   |-- aas		: amino acid level
    |   `-- cds		: codon level
    |-- data_ml		: data used for generating classification model.
    |-- data_feats		: features generated by ana0_getfeats.

Format of `data_lbl`
--------------------

.. code-block:: text

    prj_dh (project directory)
    |-- data_lbl                                : frequencies of mutants
    |   `-- aas/cds
    |       |-- column  ref                      : Wild-type residue/nucleotide
    |       |-- column  mut                      : Mutated residue/nucleotide
    |       |-- column  mutids                   : ID of mutant <ref><index><mut>    
    |       |-- columns NiA,NiAcut,NiAcutlog    : raw, thresholded(cut) and log of depth for all(A) mutants
    |       |-- columns NiS,NiScut,NiScutlog    : raw, thresholded(cut) and log of depth for synonymous(S) mutants
    |       `-- columns NiN,NiNcut,NiNcutlog    : raw, thresholded(cut) and log of depth for non-synonymous(N) mutants

Format of `data_fit`
--------------------

.. code-block:: text

    prj_dh (project directory)
    |-- data_fit                            : fitness of mutants
    |   `-- aas/cds
    |       |-- column  ref                  : Wild-type residue/nucleotide
    |       |-- column  mut                  : Mutated residue/nucleotide
    |       |-- column  mutids               : ID of mutant <ref><index><mut>    
    |       |-- columns NiAunsel,NiAsel     : log of depth for all(A) mutants in unselected(unsel) and selected(sel) pool 
    |       |-- columns NiSunsel,NiSsel     : log of depth for synonymous(S) mutants in unselected(unsel) and selected(sel) pool
    |       |-- columns FCA,FiA             : Fold change(FC) and fitness(Fi) of all(A) mutants
    |       |-- columns FCS,FiS             : Fold change(FC) and fitness(Fi) of synonymous(S) mutants
    |       `-- column  class_fit           : class of fitness
    |           |-- value = beneficial      : if fitness(Fi) > 2  
    |           |-- value = neutral         : if fitness(Fi) < 2 & > -2
    |           |-- value = deleterious     : if fitness(Fi) < -2
    |           |-- value = killed          : if not detected in selected(sel) pool
    |           `-- value = survived        : if not detected in unselected(unsel) pool
    
Format of `data_comparison`
---------------------------

.. code-block:: text

    prj_dh (project directory)
    |-- data_comparison                     : comparison of fitness of mutants between test (eg. treated) and control (eg. untreated).
    |   `-- aas/cds
    |       |-- column ref                  : Wild-type residue/nucleotide
    |       |-- column mut                  : Mutated residue/nucleotide
    |       |-- column mutids               : ID of mutant <ref><index><mut>    
    |       |-- columns Fi_ctrl,Fi_test    : Fitness(Fi) of all(A) mutants in control and test respectively
    |       |-- columns class_fit_ctrl,class_fit_test     : class of fitness in control and test respectively
    |       `-- column class_comparison     : class of comparison
    |           |-- value = positive        : if class_fit_ctrl != beneficial  & class_fit_test == beneficial  
    |           |-- value = stabilizing     : if class_fit_ctrl != neutral     & class_fit_test == neutral
    |           |-- value = negative        : if class_fit_ctrl != deleterious & class_fit_test == deleterious
    |           `-- value = robust          : if class_fit_ctrl == class_fit_test
